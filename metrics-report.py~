#!/usr/bin/python

with open('metrics.csv', 'w') as csvfile:
    writer = csv.DictWriter(csvfile, fieldnames=['date', 'Code-Review',
                                                 'Workflow', 'commits',
                                                 'referenced-bugs',
                                                 'resolved-bugs'])
    writer.writeheader()

    d = period_start
    while d < datetime.datetime.now():
        summary = {'date': datetime.datetime.strftime(d, '%Y-%b-%d'),
                   'Code-Review': 0,
                   'Workflow': 0,
                   'commits': 0,
                   'referenced-bugs': 0,
                   'resolved-bugs': 0}
        try:
            key = (d.year, d.month, d.day)
            for engineer in events.get(key, {}):
                for (event, value, project) in events[key][engineer]:
                    if event.startswith('Self-'):
                        event = event[len('Self-'):]
                    summary[event] += 1
        except Exception as e:
            print engineer
            print
            print e
            sys.exit(1)

        writer.writerow(summary)

        d += datetime.timedelta(days=1)
